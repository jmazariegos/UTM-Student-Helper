

<!DOCTYPE html>
<html>
   <head>
      <title>Our UTM</title>
      <meta charset="UTF-8">
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <script src="https://sdk.amazonaws.com/js/aws-sdk-2.2.32.min.js"></script> 
      <script src="Website/jquery-3.3.1.min.js"></script>
      <script src="Website/client.js"></script>
      <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/css/bootstrap.min.css">
      <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/js/bootstrap.min.js"></script>
      <link rel="stylesheet" type="text/css" href="Website/layout.css">
      <!-- <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous"> -->
      <!-- Move to Client.js -->
      <!--  -->

            <script src="./Scripts/reloadTimetable.js"></script>

      <script type="text/javascript">
         $(document).ready( function () {
            $('form').submit( function () {
               var formdata = $(this).serialize();
               $.ajax({
                  type: "POST",
                  url: "",
                  data: formdata
               });
               return false;
            });
         });
      </script>
   </head>
   <body>
      <!-- Login page
         ----------------------------------------------------------
         -->
      <div class="navbar">
         <nav class="navbar navbar-inverse navbar-fixed-top">
            <img id="logo" src="Website/logo.jpeg" width="30" height="30" class="d-inline-block align-top" alt="">
            <!-- <img src = ></img> -->
         </nav>
      </div>
      <div class="Body">
      <div id="login">
         <!-- Login stuff  -->
         <div id="cont">
            <div id="quote">
               <h1>Let us share Our Work and Our Schedules.<br>
                  This is not <strong>YOUR UTM</strong> nor <strong>MY UTM.</strong><br>
                  THIS IS <Strong>OUR UTM.</Strong>
               </h1>
            </div>
            <div id="in">
               <h2>Login:</h2>
               <br>
               <table>
                  <tr>
                     <td>
                        E-Mail:
                     </td>
                     <td>
                        <input id="lemail" type="Email" required><br>
                     </td>
                  </tr>
                  <tr>
                     <td>
                        Password:
                     </td>
                     <td>
                        <input id="lpass" type="password" required><br>
                     </td>
                  </tr>
               </table>
               <br>
               <button id="loginButton" type="submit" class="btn btn-default">Login<br></button><br>
               <br>
               <div class="btn-toolbar">
                  <button id="Reglink" class="btn btn-primary" data-toggle="modal" data-target="#reg">Register<br></button>
                  <button id="Forgot" class="btn btn-primary" data-toggle="modal" data-target="#reset">Forgot Password<br></button>
               </div>
            </div>
         </div>
         <!-- </form> -->
      </div>
      <!-- Regstration page
         ----------------------------------------------------------
         -->
      <div id="reg" class="modal fade" role="dialog">
         <div class="modal-dialog">
            <div class="modal-content">
               <div class="modal-header">
                  <h1>Registration:</h1>
               </div>
               <div class="modal-body">
                  <table>
                     <tr>
                        <td>
                           User Name:
                        </td>
                        <td>
                           <input id="ruserid" name="userid" required><br>
                        </td>
                     </tr>
                     <tr>
                        <td>
                           E-Mail:
                        </td>
                        <td>
                           <input id="remail" type="Email" name="Email" required><br>
                        </td>
                     </tr>
                     <tr>
                        <td>
                           Password:
                        </td>
                        <td>
                           <input id="rpass1" type="password" required><br>
                        </td>
                     </tr>
                     <tr>
                        <td>
                           Confirm Password:
                        </td>
                        <td>             
                           <input id="rpass2" type="password" required><br>
                        </td>
                     </tr>
                  </table>
               </div>
               <div class="modal-footer">
                  <button id="regButton" type="submit" class="btn btn-primary">Submit<br></button>
                  <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
               </div>
            </div>
         </div>
      </div>
      <!-- Reset page
         ----------------------------------------------------------
         -->
      <div id="reset" class="modal fade" role="dialog">
         <div class="modal-dialog">
            <div class="modal-content">
               <div class="modal-header">
                  <h1>Forgot Password:</h1>
               </div>
               <div class="modal-body">
                  Email:
                  <input id="resemail" type='Email' required>
               </div>
               <div class="modal-footer">
                  <div class="btn-toolbar">
                     <button id="resetButton" type="submit" class="btn btn-primary">Submit<br></button>
                     <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                  </div>
               </div>
            </div>
         </div>
      </div>
      <!-- Home page
         ----------------------------------------------------------
         -->
      <div class="" id="sidebar">
         <ul class="nav nav-pills nav-stacked">
            <li id="side-home" class="active nav-link"> 
               <a href="" onclick="return false;">Home<br></a>
            </li>
            <li id="side-calendar" class="active nav-link"> 
               <a href="" onclick="return false;">Calendar<br></a>
            </li>
            <li id="side-notes" class="active nav-link"> 
               <a href="" onclick="return false;">Notes<br></a>
            </li>
            <li id="side-timetable" class="active nav-link"> 
               <a href="" onclick="return false;">Timetable<br></a>
            </li>
            <li id="side-friends" class="active nav-link"> 
               <a href="" onclick="return false;">Friends<br></a>
            </li>
            <li id="side-map"       class="active nav-link"> 
               <a href="" onclick="return false;">Map<br></a>
            </li>
            <li id="side-settings"  class="active nav-link"> 
               <a href="" onclick="return false;">Settings<br></a>
            </li>
            <li id='side-logout' class="nav-link"> 
               <a href="" onclick="return false;">Logout<br></a>
            </li>
         </ul>
      </div>
      <div id="home" class="beside">
         <!-- Burger -->
         <div class="row py-3">
            <!-- Calender Body -->
            <div class="col offset-2" id="main">
               <h2>Time Table</h2>
               <table id="timetable1">
                  <tr>
                     <th>Sunday</th>
                     <th>Monday</th>
                     <th>Tuesday</th>
                     <th>Wednesday</th>
                     <th>Thursday</th>
                     <th>Friday</th>
                     <th>Saturday</th>
                  </tr>
                  <tr>
                     <td>27</td>
                     <td>28</td>
                     <td>29</td>
                     <td>30</td>
                     <td>31</td>
                     <td>1</td>
                     <td>2</td>
                  </tr>
                  <tr>
                     <td>3</td>
                     <td>4</td>
                     <td>5</td>
                     <td>6</td>
                     <td>7</td>
                     <td>8</td>
                     <td>9</td>
                  </tr>
                  <tr>
                     <td>10</td>
                     <td>11</td>
                     <td>12</td>
                     <td>13</td>
                     <td>14</td>
                     <td>15</td>
                     <td>16</td>
                  </tr>
                  <tr>
                     <td>17</td>
                     <td>18</td>
                     <td>19</td>
                     <td>20</td>
                     <td>21</td>
                     <td>22</td>
                     <td>23</td>
                  </tr>
                  <tr>
                     <td>24</td>
                     <td>25</td>
                     <td>26</td>
                     <td>27</td>
                     <td>28</td>
                     <td>1</td>
                     <td>2</td>
                  </tr>
               </table>
               <!-- Side Buttons -->
            </div>
         </div>
      </div>
      <!-- Map page
         ----------------------------------------------------------
         -->
      <div id="map"  class="beside">
         <h1 id="mapTitle"></h1>
         <!-- Our map image -->
         <div id="mapContainer">
            <!-- The map image -->
            <img id="mapImg" />
            <!-- Link Buttons -->
            <table id="mapButtons">
            </table>
         </div>
         <div>
            <table id="foodTable"></table>
         </div>
      </div>
      <!-- Account page
         ----------------------------------------------------------
         -->
      <div class="account" class="beside"></div>
      <!-- Note page
         ----------------------------------------------------------
         -->
      <div class="note" class="beside"></div>
      <!-- Friends page
         ----------------------------------------------------------
         -->
      <div id="friends" class="beside">
         <h3>Search For Friend:</h3>
         <br>
         <form class="form-inline md-form mr-auto mb-4">
            <input id="SearchBar"class="form-control mr-sm-2" type="text" placeholder="Search" aria-label="Search">
            <button id="Search-button" class="btn btn-outline-warning btn-rounded btn-sm my-0">Search</button>
         </form>
         <!-- Our map image -->
         <div >
            <h2>Friends</h2>
            <table id='friend-list'>
            </table>
         </div>
         <div >
            <h2>Requests</h2>
            <table id='pending-list'>
            </table>
         </div>
         <div >
            <h2>Blocked</h2>
            <table id='blocked-list'>
            </table>
         </div>
      </div>
      <!-- Timetable Page page ---------------------------------------------------------- -->
      <div id="tt" class="beside">
         		<div id="search-container" class="inline">
			<div id="course-container">
			</div>
			<div id="searchbar-container">
				<input type="text" id="searchbar" placeholder="Search..">
			</div>
			<div id="criteria" class="inline">
				<select name="session">
					<option value="fall/winter">Fall/Winter</option>
					<option value="summer">Summer</option>
				</select>
				<select name="semester">
					<option value="F">First</option>
					<option value="S">Second</option>
				</select>
				<div id="calendar-upload">
					<input type="file" id="file">
					<input type="submit" id="upload" value="Upload">
				</div>
			</div>
			<div id="search-results-container">
				<table id="courses"></table>
			</div>
			<script>
				//elements checked and editted
				const $searchbar = document.querySelector('#searchbar');
				const $table = document.querySelector('#courses');
				const $courseinfo = document.querySelector('#course-container');
				const $session = document.querySelector('select[name=\'session\']');
				const $semester = document.querySelector('select[name=\'semester\']');
				const $generate = document.querySelector('#generate');
				const $cart = document.querySelector('#cart');
				
				const $upload = document.querySelector('#upload'); //upload stuff
				upload.onclick = function(event){
					var input = document.querySelector('#file');
					if (input.files && input.files[0] && input.files[0]) {
						if(!input.files[0].name.endsWith('.ics')){
							alert("I only accept ics files.");
							return;
						}
					    var reader = new FileReader();
					    reader.onload = function (e) {
					    	var lines = reader.result.split('\n');
					    	var courses = {};
					    	var read = false;
					      	for(var i = 0; i < lines.length; i++){
					      		if(lines[i].includes("END:VEVENT")){
					      			read = false;
					      		}
					      		if(read){
					      			if(lines[i].includes("SUMMARY:")){
					      				var summary = lines[i].substring(8);
					      				var list = summary.split(' ');
					      				if(!courses[list[0]]){
					      					courses[list[0]] = [];
					      				}
					      				courses[list[0]].push(list[1]);
					      			}
					      		}
					      		if(lines[i].includes("BEGIN:VEVENT")){
					      			read = true;
					      		}
					      	}
					      	console.log(courses);
					      	for(var course in courses){
					      		get = {
					      			"code": course.substring(0,6),
					      			"session": $session.value,
					      			"semester":	$semester.value      				
					      		};
					      		$.getJSON("http://localhost:8080/courses/", get, function(list){
					      			var data = list[0];
					      			if(!data){
					      				return;
					      			}
					      			console.log(data);
					      			var post = {
							            "code": data.code,
							            "session": data.session,
							            "semester": data.semester,
							            "name": data.name,
							            "description": data.description,
							            "lecture": {},
							            "tutorial": {},
							            "practical": {}
					      			}
						      		for(var i = 0; i < courses[course].length; i++){
						      			var section;
						      			if(courses[course][i].includes("LEC")){
						      				section = data.lectures;
							      			for(var j = 0; j < section.length; j++){
							      				if(courses[course][i].includes(section[j].section)){
							      					post.lecture = section[j];
							      				}
							      			}
						      			}else if(courses[course][i].includes("TUT")){
						      				section = data.tutorials;
							      			for(var j = 0; j < section.length; j++){
							      				if(courses[course][i].includes(section[j].section)){
							      					post.tutorial = section[j];
							      				}
							      			}
						      			}else if(courses[course][i].includes("PRA")){
						      				section = data.practicals;
							      			for(var j = 0; j < section.length; j++){
							      				if(courses[course][i].includes(section[j].section)){
							      					post.practical = section[j];
							      				}
							      			}
						      			}
						      		}
					      			if(post.lecture === {}){ //doesnt work?
					      				return;
					      			}
							        $.ajax({ //request to add course to timetable (refer to above ajax)
							        	url: "http://localhost:8080/timetable/",
							        	type: "POST",
							        	data: JSON.stringify(post),
							        	dataType: 'json',
							        	contentType: 'application/json',
							        	success: function(result){
							        		console.log(result);
							        	},
							        	error: function(err){
							        		console.log(err);
							        	}
							        });
					      		});
					      	}
			        		var timetable = document.getElementById("timetable");
			        		reload();
					    };
					    reader.readAsText(input.files[0]);
					}
				}
				
				const courseHandler = function(e){ //handler for when a course is clicked from the table
					for(var i = 0, row; row = $table.rows[i]; i++) {
						for(var j = 0, col; col = row.cells[j]; j++) { //make all courses white
							col.style.backgroundColor = "white";
						}
					}
					e.target.style.backgroundColor = "grey"; //set the color for the chosen course
					var data = { //query data
							"code": e.target.innerHTML.substring(0, 8),
							"session": $session.value, //current session (value in the dropdown menu)
							"semester": $semester.value //current semester (same)
					}
					$.getJSON("http://localhost:8080/courses/", data, function(courses){ //get courses that match the data (but this is for a single course)
						console.log(courses); //uh
						var course = courses[0]; //only one course so courses only contains one course
						text = "<p>" + course.code + course.semester + "<br>"; //start building the course info to be displayed
						text += course.name + "<br><br></p>";
						text += course.description + "</div>";
						text += "<div><table name=\"lectures\">";
						for(var i = 0; i < course.lectures.length; i++){ //lecture radio buttons
							lecture = course.lectures[i];
							text += "<tr><td><input type=\"radio\" name=\"lecture\" value=\"" + i + "\"><label>LEC" + lecture.section + "</label></td><td><p>";
							for(var j = 0; j < lecture.timings.length; j++){
								timing = lecture.timings[j];
								text += timing[0] + " " + timing[1] + "-" + timing[2] + "<br>";
							}
							text += "</td></tr>";
						}
						for(var i = 0; i < course.tutorials.length; i++){ //tuts
							tutorial = course.tutorials[i];
							text += "<tr><td><input type=\"radio\" name=\"tutorial\" value=\"" + i + "\"><label>TUT" + tutorial.section + "</label></td><td><p>";
							for(var j = 0; j < tutorial.timings.length; j++){
								timing = tutorial.timings[j];
								text += timing[0] + " " + timing[1] + "-" + timing[2] + "<br>";
							}
							text += "</td></tr>";
						}
						for(var i = 0; i < course.practicals.length; i++){ //pras
							practical = course.practicals[i];
							text += "<tr><td><input type=\"radio\" name=\"practical\" value=\"" + i + "\"><label>PRA" + practical.section + "</label></td><td><p>";
							for(var j = 0; j < practical.timings.length; j++){
								timing = practical.timings[j];
								text += timing[0] + " " + timing[1] + "-" + timing[2] + "<br>";
							}
							text += "</td></tr>"; //end of course display
						}
						$.getJSON("http://localhost:8080/timetable/exists", data, function(result){ //returns if a course already exists in the timetable
							if(result){ //course exists in timetable
								text += "</table><input type=\"submit\" value=\"Modify course\" name=\"enrol\">";
								text += "<input type=\"submit\" value=\"Unenrol in course\" name=\"unenrol\"></div>";
								$courseinfo.innerHTML = text;
								
								unenrolBtn = document.querySelector('input[name=\'unenrol\']');
								if(unenrolBtn){ //button for unenrolling
									console.log(data);
									unenrolBtn.onclick = function(element){
								        $.ajax({ //request to delete the course from the timetable
								        	url: "http://localhost:8080/timetable/", //endpoint
								        	type: "DELETE", //method
								        	data: JSON.stringify(data), //data (ajax = stringify else send just data)
								        	dataType: 'json', //type (you need this)
								        	contentType: 'application/json', //content type (also need this)
								        	success: function(result){ //when it works
								        		console.log(result);
								        		unenrolBtn.parentNode.removeChild(unenrolBtn); //remove unenrol button since you aren't enrolled anymore
								        		document.querySelector('input[name=\'enrol\']').value = "Enrol in course"; //make enrol button again
										        var timetable = document.getElementById("timetable");
										        reload(); //this just reloads the timetable (check reloadTimetable.js in scripts)
								        	},
								        	error: function(err){ //something went wrong
								        		console.log(err);
								        	}
								        });
									};
								}
							}else{ //course not in timetable
								text += "</table><input type=\"submit\" value=\"Enrol in course\" name=\"enrol\"></div>"; //just enrol button
								$courseinfo.innerHTML = text; //places text into the html making the elements
							}
							enrolBtn = document.querySelector('input[name=\'enrol\']');
							if(enrolBtn){ //adds script to enrol button
								enrolBtn.onclick = function(element){ //when i click this should happen
									var lecture = -1;
									document.querySelectorAll('input[name=\'lecture\']').forEach(function(radio){ //check which lecture was chosen
										if(radio.checked){
											lecture = radio.value;
											return;
										}
									});
									if(lecture === -1){ //no lecture chosen (mandatory)
										alert("Choose a lecture section.");
										return;
									}
									var tutorial = {}; //same but tutorial and not mandatory
									document.querySelectorAll('input[name=\'tutorial\']').forEach(function(radio){
										if(radio.checked){
											tutorial = course.tutorials[radio.value];
											return;
										}
									});
									var practical = {}; //pras
									document.querySelectorAll('input[name=\'practical\']').forEach(function(radio){
										if(radio.checked){
											practical = course.practicals[radio.value];
											return;
										}
									});
							        var newCourse = { //new course being enrolled in
							            "code": course.code,
							            "session": course.session,
							            "semester": course.semester,
							            "name": course.name,
							            "description": course.description,
							            "lecture": course.lectures[lecture],
							            "tutorial": tutorial,
							            "practical": practical
							        };
							        $.ajax({ //request to add course to timetable (refer to above ajax)
							        	url: "http://localhost:8080/timetable/",
							        	type: "POST",
							        	data: JSON.stringify(newCourse),
							        	dataType: 'json',
							        	contentType: 'application/json',
							        	success: function(result){
							        		enrolBtn.value = "Modify course";
							        		enrolBtn.insertAdjacentHTML("afterend", "<input type=\"submit\" value=\"Unenrol in course\" name=\"unenrol\">");
											unenrolBtn = document.querySelector('input[name=\'unenrol\']');
											if(unenrolBtn){ //literally the same as above (refer to above ajax)
												console.log(data);
												unenrolBtn.onclick = function(element){
											        $.ajax({
											        	url: "http://localhost:8080/timetable/",
											        	type: "DELETE",
											        	data: JSON.stringify(data),
											        	dataType: 'json',
											        	contentType: 'application/json',
											        	success: function(result){
											        		console.log(result);
											        		unenrolBtn.parentNode.removeChild(unenrolBtn);
											        		enrolBtn.value = "Enrol in course";
													        var timetable = document.getElementById("timetable");
													        reload();
											        	},
											        	error: function(err){
											        		console.log(err);
											        	}
											        });
												};
											}
							        		console.log(result);
									        var timetable = document.getElementById("timetable");
									        reload();
							        	},
							        	error: function(err){
							        		console.log(err);
							        	}
							        });
								}
							}
						});
					});
				}
				
				const typeHandler = function(e){ //handler for the searchbar
					if(e.target.value === ""){
						$table.innerHTML = "";
						return;
					}
					data = { //query from searchbar
							"code": e.target.value,
							"session": $session.value,
							"semester": $semester.value
					}
					$.getJSON("http://localhost:8080/courses/", data, function(courses){ //get request for all matching courses
						console.log(courses);
						text = "";
						for(var key in courses){ //make entries for all the matching courses
							course = courses[key];
							text += "<tr><td class=\"course\">" + course.code + course.semester + "</td></tr>";
						}
						$table.innerHTML = text;
						
						document.querySelectorAll('.course').forEach(function(element){
							element.addEventListener('click', courseHandler); //adding the handler for clicking a course to all the courses
						});
					});
				}
				
				$session.oninput = function(){ //i changed the session act like i changed the searchbar (makes results consistent)
					$searchbar.dispatchEvent(new Event('input'));
					reload();
				}
				$semester.oninput = function(){ //same
					$searchbar.dispatchEvent(new Event('input'));
					reload();
				}
				$searchbar.addEventListener('input', typeHandler); //searchbar getting its handler
				$searchbar.addEventListener('propertyChange', typeHandler); //same here
			</script>
		</div>
		<div id="timetable-container" class="inline">
			<table id="timetable"></table>
			<script>
				var days = ["", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday"]; //this whole script just makes the timetable layout not alot to say about it
				var text = "<tr>";
				for(var i = 0; i < 6; i++){
					text += "<th>" + days[i] + "</th>";
				}
				text += "</tr>"; 
				for(var i = 8; i < 23; i++){
					text += "<tr>";
					if(i < 13){
						text += "<th class=\"time\">" + i + ":00";
					}else{
						text += "<th class=\"time\">" + (i - 12) + ":00"; 
					}
					for(var j = 0; j < 5; j++){
						text += "<td class=\"timeslot\"></td>";
					}
					text += "</tr>"
				}
				var timetable = document.getElementById("timetable");
				timetable.innerHTML = text;
		        reload();
			</script>
		</div>
      </div>
      <!-- Calender Page page ---------------------------------------------------------- -->
      <div id="cal" class="beside">
         <div id="calender-div">
            <table id="calendar">
               <script> 
                  //request.open('GET', 'https://github.com/jessly5/301tsv/blob/master/calendar.json', true);
                  //xmlhttp https://www.w3schools.com/js/tryit.asp?filename=tryjson_http
                  //document.getElementById("course-list").innerHTML = JSON.stringify($courses[0].code);
                  
                  <!--parse timeTable-->
                  var url = "./data/timeTable.json";
                     
                  $.getJSON(url, function(courses) {
                     console.log(courses); //this writes to the console, and I think we need this request to access data
                     
                     var days = {"SU":0, "MO":1, "TU":2, "WE":3, "TH":4, "FR":5, "SA":6};
                     var calendar = document.getElementById("calendar");
                     
                     var course_list_len = courses.length;
                     
                     for (key in courses){ //go through each course
                     
                        var code = courses[key].code;
                        var ses = courses[key].session;
                        var name = courses[key].name;
                        var description = courses[key].description;
                        
                        var lec = courses[key].lecture; //0 since we only have once tuple in the list of lectures
                        var section = lec.section;
                        var time = lec.timings;
                  
                        for(j=0; j < time.length; j++) { //go through each lecture
                           var d = time[j][0];
                           var day_index = days[d];
                           var start = time[j][1];
                           var end = time[j][2];
                           for (var k = 1, row; row = calendar.rows[k]; k++) { //1 because row of table headers is 0
                              for (var m = 1, col; col = row.cells[m]; m++) { //1 because no classes on sunday
                                 if (m == day_index){                                           
                                    var new_node = "<div class=\"class\"><b>Lecture: </b>"+code+"<br/>"+start+"-"+end+"<\div><br/><div class=\"classinfo\"><b>Name</b>: "+name+"<br/><b>Session</b>: "+section+"<br/><b>Info</b>: "+description+"<\div>";
                                    col.insertAdjacentHTML('beforeend', new_node);                       
                                 }
                              }  
                           }
                        }
                        
                        var tutorials = courses[key].tutorial;
                        time = tutorials.timings;
                        section = tutorials.section;
                        if (time){
                           for(j=0; j < time.length; j++) { //go through each tutorial
                              var d = time[j][0]; 
                              var day_index = days[d];
                              var start = time[j][1];
                              var end = time[j][2];
                              for (var k = 1, row; row = calendar.rows[k]; k++) { //1 because row of date names is 0
                                 for (var m = 1, col; col = row.cells[m]; m++) {
                                    if (m == day_index){                                           
                                       var new_node = "<div class=\"class\"><b>Tutorial: </b>"+code+"<br/>"+start+"-"+end+"<\div><br/><div class=\"classinfo\"><b>Name</b>: "+name+"<br/><b>Session</b>: "+section+"<br/><b>Info</b>: "+description+"<\div>";
                                       col.insertAdjacentHTML('beforeend', new_node);                       
                                    }
                                 }  
                              }
                           }
                        }
                        var practical = courses[key].practical;
                        
                        time = practical.timings;
                        section = practical.section;
                        
                        for(j=0; j < time.length; j++) { //go through each practical
                           var d = time[j][0]; 
                           var day_index = days[d];
                           var start = time[j][1];
                           var end = time[j][2];
                           for (var k = 1, row; row = calendar.rows[k]; k++) { //1 because row of date names is 0
                              for (var m = 0, col; col = row.cells[m]; m++) {
                                 if (m == day_index){                                           
                                    var new_node = "<div class=\"class\"><b>Practical: </b>"+code+"<br/>"+start+"-"+end+"<\div><br/><div class=\"classinfo\"><b>Name</b>: "+name+"<br/><b>Session</b>: "+section+"<br/><b>Info</b>: "+description+"<\div>";
                                    col.insertAdjacentHTML('beforeend', new_node);                       
                                 }
                              }  
                           }
                        }
                        
                     }        
                  });
                  
                  // <!--parse events-->
                  var url = "http://localhost:8080/events/";
                     
                  $.getJSON(url, function(data) {
                     console.log(data); //this writes to the console, and I think we need this request to access data
                     
                     var calendar = document.getElementById("calendar");
                     
                     var events = data;
                     var events_list_len = events.length;         
                     
                     
                     // <!--parse events' events-->
                     for (i=0; i < events_list_len; i++){
                        var eventName = events[i].eventName;
                        var description = events[i].description; //
                        var startDate = events[i].startDate;
                        var startTime = events[i].startTime;
                        var endDate = events[i].endDate;
                        var endTime = events[i].endTime;
                        
                        //here we will add ":"
                        //note to do am/pm stuff it would be startTime = (parseInt(startTime)-1200).toString(); etc
                        startTime = startTime.slice(0,2)+":"+startTime.slice(2); //because of our time format, it will always be 4 digits
                        endTime = endTime.slice(0,2)+":"+endTime.slice(2); 
                        
                        //warning: hardcoding it to work for february only. for multi months, needs more check.
                        var startDateNum = startDate.substring(6, 8);
                        var endDateNum = endDate.substring(6, 8);
                        
                        for (var k = 1, row; row = calendar.rows[k]; k++) { //1 because row of table headers is 0
                           for (var m = 0, col; col = row.cells[m]; m++) {
                              var td_value = col.innerHTML.substring(0, 2);
                              if (td_value.substring(1,2) == "<" || td_value.length == 1) { //the single digit dates with stuff happening gave me a "<"
                                 td_value = "0"+td_value.substring(0,1);
                              }
                              var td_value_int = parseInt(td_value);
                              var startDateNum_Int = parseInt(startDateNum);
                              var endDateNum_Int = parseInt(endDateNum);
                              if (td_value_int >= startDateNum_Int && td_value_int <= endDateNum_Int){ //in case an event is longer than a day  
                                 startDate = startDate.substring(0,4)+"/"+startDate.substring(4,6)+"/"+startDate.substring(6, 8);
                                 endDate = endDate.substring(0,4)+"/"+endDate.substring(4,6)+"/"+endDate.substring(6, 8);
                                 var new_node = "<div class=\"events\"><b>Event: </b>"+eventName+"<br/>"+startTime+"-"+endTime+"<\div><br/><div class=\"eventsinfo\"><b>Date</b>: "+startDate+"-"+endDate+"<br/><b>Info</b>: "+description+"<\div>";
                                 col.insertAdjacentHTML('beforeend', new_node);                       
                              }
                           }  
                        }
                     }
                  
                  });
                  
                  //dfjklasdfjhadshkflkads
                  // <!--parse dueDates-->
                  var url = "http://localhost:8080/duedates/";
                     
                  $.getJSON(url, function(data) {
                     console.log(data); //this writes to the console, and I think we need this request to access data
                     
                     var calendar = document.getElementById("calendar");
                              
                     var dueDates = data;
                     var dueDates_list_len = dueDates.length;
                     <!--parse events dueDates-->
                     for (i=0; i < dueDates_list_len; i++){
                        var code = dueDates[i].courseCode;
                        var assignmentName = dueDates[i].assignmentName;
                        var description = dueDates[i].description;
                        var dueDate = dueDates[i].dueDate;
                        var dueTime = dueDates[i].dueTime;
                        
                        dueTime = dueTime.slice(0,2)+":"+dueTime.slice(2);
                        var dueDateNum = dueDate.substring(6, 8);
                        
                        for (var k = 1, row; row = calendar.rows[k]; k++) { //1 because row of table headers is 0
                           for (var m = 0, col; col = row.cells[m]; m++) {
                              var td_value = col.innerHTML.substring(0, 2);
                              if (td_value.substring(1,2) == "<" || td_value.length == 1) { //the single digit dates with stuff happening gave me a "<"
                                 td_value = "0"+td_value.substring(0,1);
                              }
                              if (td_value == dueDateNum){
                                 dueDate = dueDate.substring(0,4)+"/"+dueDate.substring(4,6)+"/"+dueDate.substring(6, 8);
                                 var new_node = "<div class=\"dueDates\"><b>Course: </b>"+code+"<br/> <b>Deadline</b>: "+dueTime+"<\div><br/><div class=\"dueDateinfo\"><b>Date</b>: "+dueDate+"<br/><b>Assignment</b>: "+assignmentName+"<br/><b>Info</b>: "+description+"<\div>";
                                 col.insertAdjacentHTML('beforeend', new_node);                       
                              }
                           }  
                        }
                     }
                  });
                  ///ddfkjlasdfjkadshkfjasd
                  
               </script>
               <tr>
                  <th>Sunday</th>
                  <th>Monday</th>
                  <th>Tuesday</th>
                  <th>Wednesday</th>
                  <th>Thursday</th>
                  <th>Friday</th>
                  <th>Saturday</th>
               </tr>
               <tr>
                  <td>27</td>
                  <td>28</td>
                  <td>29</td>
                  <td>30</td>
                  <td>31</td>
                  <td>1</td>
                  <td>2</td>
               </tr>
               <tr>
                  <td>3</td>
                  <td>4</td>
                  <td>5</td>
                  <td>6</td>
                  <td>7</td>
                  <td>8</td>
                  <td>9</td>
               </tr>
               <tr>
                  <td>10</td>
                  <td>11</td>
                  <td>12</td>
                  <td>13</td>
                  <td>14</td>
                  <td>15</td>
                  <td>16</td>
               </tr>
               <tr>
                  <td>17</td>
                  <td>18</td>
                  <td>19</td>
                  <td>20</td>
                  <td>21</td>
                  <td>22</td>
                  <td>23</td>
               </tr>
               <tr>
                  <td>24</td>
                  <td>25</td>
                  <td>26</td>
                  <td>27</td>
                  <td>28</td>
                  <td>1</td>
                  <td>2</td>
               </tr>
            </table>
         </div>
         <div id="addEvent">
            <h2>Add an Event</h2>
            <label for="eventName">Event name: </label>
            <input id="eventName" name="eventName"><br>
            <label for="description">Description: </label>
            <input id="description" name="description"><br>
            <label for="startDate">Start Date (YYYYMMDD): </label>
            <input id="startDate" name="startDate" ><br>
            <label for="endDate">End Date (YYYYMMDD): </label>
            <input id="endDate" name="endDate" ><br>
            <label for="startTime">Start Time (HHMM): </label>
            <input id="startTime" name="startTime" ><br>
            <label for="endTime">End Time (HHMM): </label>
            <input id="endTime" name="endTime" ><br>
            <input onclick="submitEvent()" type="submit" value="Submit">
            <p id="demo"></p>
            <script>
               function submitEvent(){ 
                   //var bob = document.getElementById("description").value;
                   //document.getElementById("demo").innerHTML = bob;
                   
                   //dfkljasjkadjkljkadsfjklfdsafff
                   
                   var newEvent = {
                    "eventName": document.getElementById("eventName").value,
                    "description": document.getElementById("description").value,
                    "startDate": document.getElementById("startDate").value,
                    "startTime": document.getElementById("startTime").value,
                    "endDate": document.getElementById("endDate").value,
                    "endTime": document.getElementById("endTime").value
                 };
                   $.ajax({
                                         url: "http://localhost:8080/events/",
                                         type: "POST",
                                         data: JSON.stringify(newEvent),
                                         dataType: 'json',
                                         contentType: 'application/json',
                                         success: function(result){
                                            console.log(result);
                                              var calender = document.getElementById("calender");
                                              //Reload Page
                                         },
                                         error: function(err){
                                            console.log(err);
                                         }
                                        });
                   //kjhasdfjhkfsjhkfdkhjfahlfdhsfdsa
                   
               }
               
            </script>
         </div>
         <div id="addDueDate">
            <h2>Add a Due Date</h2>
            <label for="assignmentName">Assignment name: </label>
            <input id="assignmentName" name="assignmentName"><br>
            <label for="courseCode">Course Code: </label>
            <input id="courseCode" name="courseCode" ><br>
            <label for="description">Description: </label>
            <input id="description" name="description"><br>
            <label for="dueDate">Due Date (YYYYMMDD): </label>
            <input id="dueDate" name="dueDate" ><br>
            <label for="dueTime">Due Time (HHMM): </label>
            <input id="dueTime" name="dueTime" ><br>
            <input onclick="submitDueDate()" type="submit" value="Submit">
            <p id="demo"></p>
            <script>
               function submitDueDate(){ 
                   //var bob = document.getElementById("description").value;
                   //document.getElementById("demo").innerHTML = bob;
                   
                   //dfkljasjkadjkljkadsfjklfdsafff
                   
                   var newDueDate = {
                    "assignmentName": document.getElementById("assignmentName").value,
                       "courseCode": document.getElementById("courseCode").value,
                    "description": document.getElementById("description").value,
                    "dueDate": document.getElementById("dueDate").value,
                    "dueTime": document.getElementById("dueTime").value
                 };
                   $.ajax({
                                         url: "http://localhost:8080/duedates/",
                                         type: "POST",
                                         data: JSON.stringify(newDueDate),
                                         dataType: 'json',
                                         contentType: 'application/json',
                                         success: function(result){
                                            console.log(result);
                                              var calender = document.getElementById("calender");
                                              //Reload Page
                                         },
                                         error: function(err){
                                            console.log(err);
                                         }
                                        });
                  
               }
               
            </script>            
         </div>
      </div>
   </body>
</html>

